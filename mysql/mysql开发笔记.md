# MySQL开发笔记

本笔记记录使用mysql过程中遇到的一些知识点，笔记均来自互联网。

## mysql操作分类

- DDL：数据库定义语言，定义数据库对象（库、表、列、索引）的操作
- DML：数据库操作语言，定义对数据库记录的操作（insert、delete、update、select）
- DCL：数据控制语言，定义对数据库、表、字段、用户的访问权限和安全级别（授权grant等）

## mysql主键分类

### 主键的作用

- 保证表的完整
- 保证表数据行的唯一性质

### 业务主键（自然主键）

在数据库表中把具有业务逻辑含义的字段作为主键，称为“自然主键（Natural Key）”。

自然主键的含义就是原始数据中存在的不重复字段，直接使用称为主键字段，这种方式对业务的耦合太强，一般不会使用。

### 逻辑主键（代理主键）

在数据库表中采用一个与当前表中逻辑信息无关的字段作为其主键，称为“代理主键”。

逻辑主键提供一个与当前表数据逻辑无关的字段作为主键，逻辑主键被广泛使用在业务表、数据表，一般有几种生成方式：uuid、自增。

其中使用最多的是自增。

逻辑主键成功的避免了主键与数据表关联耦合的问题，与业务主键不同的是，业务主键的数据一旦发生更改，那么那个系统中关于主键的所有信息都需要连带修改，这是不可避免的，并且这个更改是随业务需求的增量而不断的增加、膨胀。

而逻辑主键和应用耦合度低，它与数据无任何必要的关系，你可以只关心：第一条数据；而不用关心：名字是a的那条数据。某一天名字改成b，你还是只关心：第一条数据。

业务更改几乎是不可避免的，前期任何产品经理言之凿凿的不修改论调都是不可靠、不切实际的。我们必须考虑主键数据在更改的情况下，数据能否平稳度过危机。

### 复合主键（联合主键）

通过两次或者多个字段的组合作为主键。

符合主键可以说是业务主键的升级版本，通常一个业务字段不能够确定一条数据的唯一性，例如：张三的身份证是223222，张三这种大众名称100%会出现重复。我们可以用姓名+身份证的方式表示主键，声明一个唯一记录。

有时候，复合主键是复杂的。姓名+身份证在业务上可能不一定能表示不重复，虽然身份证在17年消除了重复的问题。可能我们需要新增一个地址作为联合主键，为了去除业务复杂度增加带来的唯一性问题，这会让主键变得很臃肿，复杂度陡升。

另外，如果其他表要与该主键关联，则需要引用复合主键的所有字段，这就不单纯是性能问题了，还有存储空间的问题了，当然你也可以认为这是合理的数据冗余，方便查询，但是感觉有点得不偿失。

使用复合主键的原因可能是：对于关系表来说，必须关联两个实体表的主键，才能表示它们之间的关系，那么可以把这两个主键联合组成复合主键即可。

如果两个实体存在多个关系，可以再加一个顺序字段联合组成复合主键，但是这样就会引入业务主键的弊端。当然，也可以另外对这个关系表添加一个逻辑主键，避免了业务主键的弊端，同时也方便其他表对它的引用。

### 性能对比

根据网络上的网友的实际测试，得出结论：

- 复合主键的数据插入是线性增长的

当数据小于100w，插入常在5s/w左右，当数据变大，插入时长无限变大，当数据达到1000w时，平均插入1w条数据已经达到15秒。

每增加一条数据，复合主键都需要判断是否重复，数据量一旦增大，每次新增都需要筛查全表。

- 查询效率

另外，逻辑主键+索引的方式，占用空间比复合主键多出一倍左右，但是实际查询体验，索引查询效率更高，所以索引应该是首选。

- 符合主键是否应该选择？

在业务主键字段不超过2-3个的情况下，需要确保数据维度的唯一性，采取符合主键加上限制，是可取的。

### 我的建议

| 数据           | 业务     | 建表选择                         |
| -------------- | -------- | -------------------------------- |
| 数据量小       | 业务简单 | 随便                             |
| 数据量小       | 业务复杂 | 逻辑主键                         |
| 数据量大       | 业务简单 | 业务主键+索引<br>或复合主键+索引 |
| 数据量大       | 业务复杂 | 逻辑主键+索引                    |
| 数据量超过千万 | *        | 逻辑主键+索引                    |

业务复杂，表示主键唯一性规则扩展需求旺盛



## mysql key分类

mysql中的key（索引）在B树种存储，各种key本身就是索引。

索引主要用于：

1. 快速找出匹配的一个where字句行
2. 当执行联结时，从其他表检索行
3. 对特定的索引列找出MAX()或MIN()值
4. 如果排序或分组，在一个可用键的最左前面加上前缀进行排序，或者分组一个表（例如：order by key_part_1, key_part_2）
5. 如果所有键值部分跟随DESC，键以倒序被读取
6. 在一些情况下，一个查询能被优化来检索值，不用咨询数据文件
7. 如果对某些表的所有使用的列是数字型，并且构成某些键的最左边前缀，为了更快，值可以从索引树被检索出来

下面是对比不同key的分类：

- primary key（主键）

这个我就不多介绍了，表数据行唯一标识

- foreign key（外键）

表示该字段，是其他表的主键（这个功能总感觉有点鸡肋）

- unique key（唯一约束）

该列数据必须唯一

- key（键）

普通索引，mysql的key和index多少有点令人迷惑，单独的key和其他关键词结合的key（primary key）实际表达的意义是不同的。

key是数据库的物理结构，它包含两层意义：

1. 约束（偏重于约束和规范数据库的结构完整性）
2. 索引（辅助查询用）

key通常是index同义词，这么做的目的是与其他数据库系统兼容

- index（索引）

简而言之，提升某列的查询速度，建立索引。



## INT和INTEGER区别

没区别，INT是INTEGER的简写



## NOT NULL和DEFAULT

- NOT NULL

表示非空约束，也就是不能向表里面插入空值

- DEFAULT

是在不给字段输入时（插入操作，字段不赋值），默认返回结果

- NOT NULL和DEFAULT能不能混用

答案是可以，但是他们不会同时生效

NOT NULL在插入“NULL”时生效

DEFAULT在字段不赋值的时候生效

**所以not null 和 default是两个独立的约束，可以用在一个字段上，但不会交互使用，是两个独立的约束条件。另外约束条件不仅是在插入数据时有用，当我们在对表数据进行修改时，也会受到约束条件的限制。**